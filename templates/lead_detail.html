{% extends "base.html" %}

{% block page_subtitle %}ğŸ“‹ Lead: {{ lead.name }}{% endblock %}

{% block content %}
<!-- Page Header -->
<div class="page-header">
    <h1 class="page-title">Lead Details</h1>
    <div class="action-buttons">
        <a href="{{ url_for('leads.edit_lead', id=lead.id) }}" class="btn btn-primary">
            <span>âœï¸</span> Edit
        </a>
        <a href="{{ url_for('leads.index') }}" class="btn btn-secondary">
            â† Back
        </a>
    </div>
</div>

<div class="grid-2">
    <!-- Lead Information -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">ğŸ‘¤ {{ lead.name }}</h2>
            <span class="status-badge status-{{ lead.status }}">{{ lead.status }}</span>
        </div>
        
        <div class="lead-detail-grid">
            <div class="detail-item">
                <div class="detail-label">Email</div>
                <div class="detail-value">{{ lead.email }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Phone</div>
                <div class="detail-value">{{ lead.phone or 'Not provided' }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Company</div>
                <div class="detail-value">{{ lead.company or 'Not provided' }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Job Title</div>
                <div class="detail-value">{{ lead.job_title or 'Not provided' }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Lead Source</div>
                <div class="detail-value">{{ lead.source }}</div>
            </div>
            <div class="detail-item">
                <div class="detail-label">Created</div>
                <div class="detail-value">{{ lead.created_at.strftime('%Y-%m-%d') }}</div>
            </div>
        </div>
        
        <!-- Quick Actions -->
        <div style="margin-top: 20px; display: flex; gap: 8px; flex-wrap: wrap;">
            <a href="{{ url_for('leads.update_status', id=lead.id, status='qualified') }}" class="btn btn-success btn-sm">âœ… Qualify</a>
            <a href="{{ url_for('leads.update_status', id=lead.id, status='converted') }}" class="btn btn-primary btn-sm">ğŸ‰ Convert</a>
            <a href="{{ url_for('leads.update_status', id=lead.id, status='lost') }}" class="btn btn-danger btn-sm">âŒ Lost</a>
            <a href="{{ url_for('leads.delete_lead', id=lead.id) }}" class="btn btn-danger btn-sm btn-delete">ğŸ—‘ï¸ Delete</a>
        </div>
    </div>
    
    <!-- AI Score & Recommendation -->
    <div class="card">
        <div class="card-header">
            <h2 class="card-title">ğŸ¤– AI Analysis</h2>
        </div>
        
        <div style="text-align: center; padding: 24px;">
            {% set bg_color = '#fef2f2' if lead.ai_score >= 70 else '#fffbeb' if lead.ai_score >= 40 else '#f0fdf4' %}
            {% set border_color = 'var(--danger-color)' if lead.ai_score >= 70 else 'var(--warning-color)' if lead.ai_score >= 40 else 'var(--success-color)' %}
            <div style="display: inline-flex; align-items: center; justify-content: center; width: 120px; height: 120px; border-radius: 50%; padding: 0;">
                <span class="score-badge score-{% if lead.ai_score >= 70 %}high{% elif lead.ai_score >= 40 %}medium{% else %}low{% endif %}" style="font-size: 2.5rem; font-weight: 700;">
                    {{ lead.ai_score }}
                </span>
            </div>
            <div style="margin-top: 16px;">
                <span class="priority-badge priority-{% if lead.ai_score >= 70 %}high{% elif lead.ai_score >= 40 %}medium{% else %}low{% endif %}">
                    {% if lead.ai_score >= 70 %}ğŸ”¥ High Priority Lead
                    {% elif lead.ai_score >= 40 %}âš¡ Medium Priority Lead
                    {% else %}ğŸ“‰ Low Priority Lead{% endif %}
                </span>
            </div>
        </div>
        
        <div style="padding: 20px; background: var(--bg-color); border-radius: var(--radius); margin-top: 16px;">
            <h4 style="margin-bottom: 8px;">ğŸ¯ Recommended Action</h4>
            <p style="font-size: 1.25rem; font-weight: 600; color: var(--primary-color);">
                {{ lead.recommended_action or 'Pending analysis...' }}
            </p>
            <p style="font-size: 0.875rem; color: var(--text-secondary); margin-top: 8px;">
                Based on lead characteristics and conversion probability
            </p>
        </div>
        
        <div style="margin-top: 16px;">
            <a href="{{ url_for('leads.rescore_lead', id=lead.id) }}" class="btn btn-secondary" style="width: 100%;">
                <span>ğŸ”„</span> Re-score with AI
            </a>
        </div>
    </div>
</div>

<!-- Scoring Factors -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">ğŸ“Š AI Scoring Factors</h2>
    </div>
    
    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 16px;">
        <div style="padding: 16px; background: var(--bg-color); border-radius: var(--radius); text-align: center;">
            <div style="font-size: 2rem; margin-bottom: 8px;">ğŸ“¢</div>
            <div class="detail-label">Source</div>
            <div class="detail-value">{{ lead.source }}</div>
        </div>
        <div style="padding: 16px; background: var(--bg-color); border-radius: var(--radius); text-align: center;">
            <div style="font-size: 2rem; margin-bottom: 8px;">ğŸ¢</div>
            <div class="detail-label">Company Size</div>
            <div class="detail-value">{{ lead.company_size }}</div>
        </div>
        <div style="padding: 16px; background: var(--bg-color); border-radius: var(--radius); text-align: center;">
            <div style="font-size: 2rem; margin-bottom: 8px;">ğŸ“ˆ</div>
            <div class="detail-label">Engagement</div>
            <div class="detail-value">{{ lead.engagement_level }} / 5</div>
        </div>
        <div style="padding: 16px; background: var(--bg-color); border-radius: var(--radius); text-align: center;">
            <div style="font-size: 2rem; margin-bottom: 8px;">ğŸ’°</div>
            <div class="detail-label">Budget</div>
            <div class="detail-value">{{ lead.budget_range }}</div>
        </div>
        <div style="padding: 16px; background: var(--bg-color); border-radius: var(--radius); text-align: center;">
            <div style="font-size: 2rem; margin-bottom: 8px;">â°</div>
            <div class="detail-label">Timeline</div>
            <div class="detail-value">{{ lead.timeline }}</div>
        </div>
    </div>
</div>

<!-- Activity Timeline -->
<div class="card">
    <div class="card-header">
        <h2 class="card-title">ğŸ“… Timeline</h2>
    </div>
    
    <div style="padding: 20px;">
        <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
            <span style="color: var(--text-secondary);">Created</span>
            <strong>{{ lead.created_at.strftime('%Y-%m-%d %H:%M') }}</strong>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
            <span style="color: var(--text-secondary);">Last Updated</span>
            <strong>{{ lead.updated_at.strftime('%Y-%m-%d %H:%M') }}</strong>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 12px 0; border-bottom: 1px solid var(--border-color);">
            <span style="color: var(--text-secondary);">Next Follow-up</span>
            <strong>{{ lead.next_followup.strftime('%Y-%m-%d') if lead.next_followup else 'Not scheduled' }}</strong>
        </div>
        <div style="display: flex; justify-content: space-between; padding: 12px 0;">
            <span style="color: var(--text-secondary);">Last Contacted</span>
            <strong>{{ lead.last_contacted.strftime('%Y-%m-%d') if lead.last_contacted else 'Never' }}</strong>
        </div>
    </div>
</div>
{% endblock %}

